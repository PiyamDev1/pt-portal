"use strict";(()=>{var e={};e.id=403,e.ids=[403],e.modules={7096:e=>{e.exports=require("bcrypt")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9810:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var r={};s.r(r),s.d(r,{POST:()=>c});var a=s(9303),o=s(8716),p=s(670),i=s(6596),u=s(7070),n=s(7096),d=s.n(n);let l=(0,i.eI)("https://ckubfbjfjbhuotyfwmac.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function c(e){try{let{userId:t,newPassword:s}=await e.json();if(!t||!s)return u.NextResponse.json({error:"Missing requirements"},{status:400});let r=[];if(s.length<8&&r.push("at least 8 characters"),/[a-z]/.test(s)||r.push("a lowercase letter"),/[A-Z]/.test(s)||r.push("an uppercase letter"),/[0-9]/.test(s)||r.push("a number"),/[!@#$%^&*(),.?":{}|<>\-_=+\\/\[\];']/.test(s)||r.push("a special character"),r.length>0)return u.NextResponse.json({error:`Password must contain ${r.join(", ")}`},{status:400});let{error:a}=await l.auth.admin.updateUserById(t,{password:s});if(a)return u.NextResponse.json({error:a.message},{status:400});let{error:o}=await l.from("employees").update({is_temporary_password:!1}).eq("id",t);if(o)return u.NextResponse.json({error:"Password set, but DB flag failed."},{status:500});try{let e=await d().hash(s,12);await l.from("password_history").insert({employee_id:t,password_hash:e});let{data:r}=await l.from("password_history").select("id").eq("employee_id",t).order("created_at",{ascending:!1}).limit(5),a=(r||[]).map(e=>e.id).filter(Boolean);a.length>0&&await l.from("password_history").delete().eq("employee_id",t).not("id","in",`(${a.join(",")})`)}catch(e){console.error("Failed to write password history:",e)}return u.NextResponse.json({success:!0,message:"Password updated successfully"},{status:200})}catch(e){return u.NextResponse.json({error:e.message},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/update-password/route",pathname:"/api/auth/update-password",filename:"route",bundlePath:"app/api/auth/update-password/route"},resolvedPagePath:"/workspaces/pt-portal/app/api/auth/update-password/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:f}=h,y="/api/auth/update-password/route";function g(){return(0,p.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,689,972],()=>s(9810));module.exports=r})();