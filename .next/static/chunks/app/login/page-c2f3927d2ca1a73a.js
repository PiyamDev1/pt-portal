(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{5495:function(e,t,s){Promise.resolve().then(s.bind(s,6374))},6374:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var a=s(7437),r=s(2265),l=s(695),i=s(9376);function n(){let[e,t]=(0,r.useState)(""),[s,n]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),b=(0,i.useRouter)(),p=(0,l.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y"),f=async e=>{var t;let{data:s}=await p.from("employees").select("is_temporary_password, locations(branch_code)").eq("id",e).single();if(null==s?void 0:s.is_temporary_password){b.push("/auth/new-password");return}let a=null==s?void 0:null===(t=s.locations)||void 0===t?void 0:t.branch_code;if(o&&a!==o)throw await p.auth.signOut(),Error("Access Denied: You are not authorized for branch ".concat(o));let{data:r}=await p.auth.mfa.getAuthenticatorAssuranceLevel();(null==r?void 0:r.nextLevel)==="aal2"?b.push("/login/verify-2fa"):b.push("/login/setup-2fa")},x=async t=>{t.preventDefault(),h(!0),u("");try{let{data:t,error:a}=await p.auth.signInWithPassword({email:e,password:s});if(a)throw a;await f(t.user.id)}catch(e){u(e.message||"Login failed"),h(!1)}},g=async()=>{await p.auth.signInWithOAuth({provider:"azure",options:{redirectTo:"".concat(window.location.origin,"/auth/callback"),scopes:"email"}})};return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50",children:(0,a.jsxs)("div",{className:"w-full max-w-md p-8 bg-white rounded-xl shadow-lg border border-slate-200",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-slate-900",children:"PT-IMS"}),(0,a.jsx)("p",{className:"text-slate-500",children:"Secure Employee Access"})]}),d&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-600 text-sm rounded border border-red-200",children:d}),(0,a.jsx)("button",{onClick:g,className:"w-full flex items-center justify-center gap-3 py-3 px-4 border border-slate-300 rounded-lg text-slate-700 bg-white hover:bg-slate-50 font-medium transition mb-6",children:(0,a.jsx)("span",{children:"Sign in with Microsoft"})}),(0,a.jsxs)("div",{className:"relative mb-6",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("div",{className:"w-full border-t border-slate-200"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,a.jsx)("span",{className:"px-2 bg-white text-slate-500",children:"Or use Branch Credentials"})})]}),(0,a.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",required:!0,className:"w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-600 outline-none",value:e,onChange:e=>t(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Password"}),(0,a.jsx)("input",{type:"password",required:!0,className:"w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-600 outline-none",value:s,onChange:e=>n(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Branch Code"}),(0,a.jsx)("input",{type:"text",required:!0,placeholder:"e.g. HQ-001",className:"w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-600 outline-none uppercase tracking-wide",value:o,onChange:e=>c(e.target.value.toUpperCase())})]}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"w-full py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition disabled:opacity-50",children:m?"Verifying...":"Next Step"})]})]})})}}},function(e){e.O(0,[340,971,117,744],function(){return e(e.s=5495)}),_N_E=e.O()}]);