(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{3571:function(e,t,a){Promise.resolve().then(a.bind(a,4486))},4486:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var n=a(7437),s=a(2265),l=a(695),o=a(9376),r=a(7648);function i(){let[e,t]=(0,s.useState)(""),[a,i]=(0,s.useState)(""),[c,u]=(0,s.useState)(!1),d=(0,o.useRouter)(),h=(0,l.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y"),m=async t=>{t.preventDefault(),i("");try{var a,n;let t=await h.auth.getUser(),s=null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.user;if(!s){i("No active session. Please sign in again.");return}if(c){if((await fetch("/api/auth/consume-backup-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,code:e})})).ok){window.history.replaceState(null,"","/dashboard"),d.push("/dashboard");return}i("Invalid or used backup code. Please try again.")}else{try{let{data:t,error:a}=await h.auth.mfa.listFactors();if(!a&&(null==t?void 0:null===(n=t.all)||void 0===n?void 0:n.length)){let a=t.all[0].id,{error:n}=await h.auth.mfa.challengeAndVerify({factorId:a,code:e});if(!n){window.history.replaceState(null,"","/dashboard"),d.push("/dashboard");return}}}catch(e){}i("Incorrect 2FA code. You can also try a backup code below.")}}catch(e){i("Verification failed. Please try again.")}};return(0,n.jsxs)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50",children:[(0,n.jsx)("div",{className:"absolute top-4 left-4",children:(0,n.jsx)(r.default,{href:"/login",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"â† Back to Login"})}),(0,n.jsxs)("div",{className:"w-full max-w-md p-8 bg-white rounded-xl shadow-lg border border-slate-200 text-center",children:[(0,n.jsx)("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-blue-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Two-Factor Authentication"}),c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-slate-500 mb-6 text-sm",children:"Enter one of your backup codes. Each code can only be used once."}),(0,n.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[(0,n.jsx)("input",{type:"text",placeholder:"Backup code",maxLength:16,autoFocus:!0,className:"w-full text-center text-xl p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none font-mono",value:e,onChange:e=>t(e.target.value)}),a&&(0,n.jsx)("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded",children:a}),(0,n.jsx)("button",{type:"submit",className:"w-full py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition",children:"Verify with Backup Code"})]}),(0,n.jsx)("button",{type:"button",className:"mt-4 text-sm text-blue-700 hover:underline",onClick:()=>{u(!1),i(""),t("")},children:"Use authenticator app"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{className:"text-slate-500 mb-6 text-sm",children:["Open Google Authenticator and enter the code for ",(0,n.jsx)("strong",{children:"Piyam Travels"}),"."]}),(0,n.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[(0,n.jsx)("input",{type:"text",placeholder:"000 000",maxLength:6,autoFocus:!0,className:"w-full text-center text-3xl tracking-[0.5em] p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none font-mono",value:e,onChange:e=>t(e.target.value)}),a&&(0,n.jsx)("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded",children:a}),(0,n.jsx)("button",{type:"submit",className:"w-full py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition",children:"Verify Identity"})]}),(0,n.jsx)("button",{type:"button",className:"mt-4 text-sm text-blue-700 hover:underline",onClick:()=>{u(!0),i(""),t("")},children:"Use backup code"})]}),(0,n.jsx)("button",{onClick:()=>d.push("/login"),className:"mt-6 text-sm text-slate-400 hover:text-slate-600",children:"Back to Login"})]})]})}}},function(e){e.O(0,[340,648,971,117,744],function(){return e(e.s=3571)}),_N_E=e.O()}]);