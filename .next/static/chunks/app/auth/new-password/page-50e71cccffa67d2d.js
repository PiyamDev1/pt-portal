(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[32],{1842:function(e,s,t){Promise.resolve().then(t.bind(t,9227))},9227:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var a=t(7437),r=t(2265),n=t(695),l=t(9376);function i(){let[e,s]=(0,r.useState)(""),[t,i]=(0,r.useState)(""),[d,o]=(0,r.useState)(!1),[u,c]=(0,r.useState)(""),[h,m]=(0,r.useState)(""),p=(0,l.useRouter)(),b=(0,n.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y");(0,r.useEffect)(()=>{!async function(){let{data:{user:e}}=await b.auth.getUser();e&&m(e.id),e?(m(e.id),c(e.email||"")):p.push("/login")}()},[]);let f=e=>{let s=[];return e.length<8&&s.push("at least 8 characters"),/[a-z]/.test(e)||s.push("a lowercase letter"),/[A-Z]/.test(e)||s.push("an uppercase letter"),/[0-9]/.test(e)||s.push("a number"),/[!@#$%^&*(),.?":{}|<>\-_=+\\/\[\];']/.test(e)||s.push("a special character"),s},x=e=>{let s=f(e);return{strength:5-s.length,errors:s}},g=async s=>{if(s.preventDefault(),e!==t)return alert("Passwords do not match");let a=f(e);if(a.length>0)return alert("Password must contain: "+a.join(", "));o(!0);let r=await fetch("/api/auth/update-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:h,newPassword:e})}),n=await r.json();if(r.ok){let{error:s}=await b.auth.signInWithPassword({email:u,password:e});s?(alert("Password updated, but auto-login failed. Please sign in manually."),p.push("/login")):p.push("/login/setup-2fa")}else alert("Error: "+n.error);o(!1)};return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-slate-100",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-xl shadow-lg border border-red-100",children:[(0,a.jsxs)("div",{className:"text-center mb-6",children:[(0,a.jsx)("div",{className:"h-12 w-12 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-3 text-2xl",children:"\uD83D\uDD12"}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:"Security Update Required"}),(0,a.jsx)("p",{className:"text-slate-500 text-sm mt-1",children:"You are using a temporary password. Please set a secure password to continue."})]}),(0,a.jsxs)("form",{onSubmit:g,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"New Password"}),(0,a.jsx)("input",{type:"password",required:!0,minLength:6,className:"w-full p-3 border rounded focus:ring-2 focus:ring-blue-900 outline-none",value:e,onChange:e=>s(e.target.value)}),e&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-slate-50 rounded border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"flex-1 h-1.5 bg-slate-200 rounded overflow-hidden",children:(0,a.jsx)("div",{className:"h-full transition-all ".concat(5===x(e).strength?"bg-green-500 w-full":x(e).strength>=3?"bg-yellow-500 w-3/4":"bg-red-500 w-1/2")})}),(0,a.jsx)("span",{className:"text-xs font-bold",children:5===x(e).strength?"✓ Strong":x(e).strength>=3?"Fair":"Weak"})]}),x(e).errors.length>0&&(0,a.jsxs)("div",{className:"text-xs text-slate-600",children:[(0,a.jsx)("p",{className:"font-bold mb-1",children:"Password must contain:"}),(0,a.jsx)("ul",{className:"space-y-0.5",children:x(e).errors.map((e,s)=>(0,a.jsxs)("li",{children:["• ",e]},s))})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Confirm Password"}),(0,a.jsx)("input",{type:"password",required:!0,minLength:6,className:"w-full p-3 border rounded focus:ring-2 focus:ring-blue-900 outline-none",value:t,onChange:e=>i(e.target.value)})]}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"w-full bg-blue-900 text-white py-3 rounded-lg font-bold hover:bg-blue-800 transition",children:d?"Updating...":"Set Password & Login"})]})]})})}}},function(e){e.O(0,[340,971,117,744],function(){return e(e.s=1842)}),_N_E=e.O()}]);