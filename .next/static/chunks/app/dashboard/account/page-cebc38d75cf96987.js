(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[813],{2728:function(e,t,s){Promise.resolve().then(s.bind(s,8690))},8690:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),r=s(2265),n=s(695),o=s(9376);function l(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(!1),d=(0,o.useRouter)(),i=(0,n.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y"),[c,u]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[h,b]=(0,r.useState)("");(0,r.useEffect)(()=>{!async function(){let{data:{user:e}}=await i.auth.getUser();e&&t(e)}()},[]);let x=async t=>{if(t.preventDefault(),m!==h)return alert("New passwords do not match");let s=[];if(m.length<8&&s.push("at least 8 characters"),/[a-z]/.test(m)||s.push("a lowercase letter"),/[A-Z]/.test(m)||s.push("an uppercase letter"),/[0-9]/.test(m)||s.push("a number"),/[!@#$%^&*(),.?":{}|<>\-_=+\\/\[\];']/.test(m)||s.push("a special character"),s.length)return alert("Password must contain: "+s.join(", "));l(!0);let{error:a}=await i.auth.signInWithPassword({email:e.email,password:c});if(a)return l(!1),alert("Incorrect current password.");let{error:r}=await i.auth.updateUser({password:m});r?alert("Failed to update password: "+r.message):(alert("Password updated successfully!"),u(""),p(""),b("")),l(!1)},f=async()=>{if(!confirm("Are you sure? This will disable your current Authenticator codes and require you to setup 2FA again."))return;l(!0);let t=await fetch("/api/auth/reset-2fa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})});if(t.ok)alert("2FA has been reset. Redirecting you to setup..."),d.push("/login/setup-2fa");else{let e=await t.json();alert("Failed to reset 2FA: "+((null==e?void 0:e.error)||"Unknown"))}l(!1)},[w,g]=(0,r.useState)(null),[j,v]=(0,r.useState)(0),N=async()=>{let t=await fetch("/api/auth/backup-codes/count?userId=".concat(e.id));t.ok&&v((await t.json()).count||0)};(0,r.useEffect)(()=>{e&&N()},[e]);let y=async()=>{if(!confirm("Generate new backup codes? Previous codes will be invalidated."))return;l(!0);let t=await fetch("/api/auth/generate-backup-codes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,count:10})}),s=await t.json();t.ok?(g(s.codes||[]),v(10)):alert("Failed to generate backup codes: "+((null==s?void 0:s.error)||"Unknown")),l(!1)},k=async()=>{if(!w)return;let e=w.join("\n");try{await navigator.clipboard.writeText(e),alert("Backup codes copied to clipboard!")}catch(e){alert("Failed to copy codes")}};return e?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-800",children:"My Account Settings"}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD12"})," Change Password"]}),(0,a.jsxs)("form",{onSubmit:x,className:"max-w-md space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Current Password"}),(0,a.jsx)("input",{type:"password",required:!0,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:c,onChange:e=>u(e.target.value)})]}),(0,a.jsx)("div",{className:"pt-2 border-t border-slate-100"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"New Password"}),(0,a.jsx)("input",{type:"password",required:!0,minLength:6,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:m,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Confirm New Password"}),(0,a.jsx)("input",{type:"password",required:!0,minLength:6,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:h,onChange:e=>b(e.target.value)})]}),(0,a.jsx)("button",{type:"submit",disabled:s,className:"bg-blue-900 text-white px-6 py-2 rounded hover:bg-blue-800 font-medium transition",children:s?"Updating...":"Update Password"})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Two-Factor Authentication"]}),(0,a.jsx)("div",{className:"flex items-start gap-4",children:(0,a.jsxs)("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg border border-green-100 flex-1",children:[(0,a.jsx)("p",{className:"font-bold",children:"Status: Active"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:"Your account is secured with Google Authenticator."})]})}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600 mb-3",children:"Lost your phone or need to re-configure?"}),(0,a.jsxs)("div",{className:"flex gap-3 items-center flex-wrap",children:[(0,a.jsx)("button",{onClick:f,disabled:s,className:"border border-red-200 text-red-600 bg-red-50 px-4 py-2 rounded hover:bg-red-100 font-medium transition text-sm",children:"Re-install 2FA Keys"}),(0,a.jsx)("button",{onClick:y,disabled:s,className:"border border-slate-200 text-slate-700 bg-white px-4 py-2 rounded hover:bg-slate-50 font-medium transition text-sm",children:"Generate Backup Codes"})]}),!w&&j>0&&(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700",children:(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Remaining backup codes:"})," ",j," unused"]})}),w&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-100 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("p",{className:"font-bold",children:"Backup codes (save these now — shown only once):"}),(0,a.jsx)("button",{onClick:k,className:"text-xs bg-white border border-yellow-200 px-2 py-1 rounded hover:bg-yellow-100 transition",children:"\uD83D\uDCCB Copy"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2 mb-3",children:w.map((e,t)=>(0,a.jsx)("div",{className:"font-mono text-sm bg-white p-2 rounded border select-all",children:e},t))}),(0,a.jsx)("button",{onClick:()=>{if(!w)return;let e=new Blob(["Piyam Travels - Backup Codes\nSave these codes in a secure location.\nEach code can be used once for 2FA.\n\n"+w.join("\n")],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="backup-codes.txt",s.click()},className:"text-xs bg-white border border-yellow-200 px-3 py-1.5 rounded hover:bg-yellow-100 transition",children:"⬇️ Download as Text File"})]})]})]})]}):(0,a.jsx)("div",{className:"p-8",children:"Loading..."})}}},function(e){e.O(0,[340,971,117,744],function(){return e(e.s=2728)}),_N_E=e.O()}]);