"use strict";(()=>{var e={};e.id=403,e.ids=[403],e.modules={7096:e=>{e.exports=require("bcrypt")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9810:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{POST:()=>l});var a=s(9303),o=s(8716),p=s(670),i=s(6596),u=s(7070),n=s(7096),d=s.n(n);async function l(e){try{let t=(0,i.eI)("https://ckubfbjfjbhuotyfwmac.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{userId:s,newPassword:r}=await e.json();if(!s||!r)return u.NextResponse.json({error:"Missing requirements"},{status:400});let a=[];if(r.length<8&&a.push("at least 8 characters"),/[a-z]/.test(r)||a.push("a lowercase letter"),/[A-Z]/.test(r)||a.push("an uppercase letter"),/[0-9]/.test(r)||a.push("a number"),/[!@#$%^&*(),.?":{}|<>\-_=+\\/\[\];']/.test(r)||a.push("a special character"),a.length>0)return u.NextResponse.json({error:`Password must contain ${a.join(", ")}`},{status:400});let{error:o}=await t.auth.admin.updateUserById(s,{password:r});if(o)return u.NextResponse.json({error:o.message},{status:400});let{error:p}=await t.from("employees").update({is_temporary_password:!1}).eq("id",s);if(p)return u.NextResponse.json({error:"Password set, but DB flag failed."},{status:500});try{let e=await d().hash(r,12);await t.from("password_history").insert({employee_id:s,password_hash:e});let{data:a}=await t.from("password_history").select("id").eq("employee_id",s).order("created_at",{ascending:!1}).limit(5),o=(a||[]).map(e=>e.id).filter(Boolean);o.length>0&&await t.from("password_history").delete().eq("employee_id",s).not("id","in",`(${o.join(",")})`)}catch(e){console.error("Failed to write password history:",e)}return u.NextResponse.json({success:!0,message:"Password updated successfully"},{status:200})}catch(e){return u.NextResponse.json({error:e.message},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/auth/update-password/route",pathname:"/api/auth/update-password",filename:"route",bundlePath:"app/api/auth/update-password/route"},resolvedPagePath:"/workspaces/pt-portal/app/api/auth/update-password/route.js",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:w}=c,f="/api/auth/update-password/route";function y(){return(0,p.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,689,972],()=>s(9810));module.exports=r})();