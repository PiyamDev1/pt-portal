(()=>{var e={};e.id=813,e.ids=[813],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1308:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),s(2644),s(1506),s(5866);var r=s(3191),a=s(8716),n=s(7922),o=s.n(n),l=s(5231),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);s.d(t,i);let d=["",{children:["dashboard",{children:["account",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2644)),"/workspaces/pt-portal/app/dashboard/account/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/workspaces/pt-portal/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspaces/pt-portal/app/dashboard/account/page.tsx"],u="/dashboard/account/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/account/page",pathname:"/dashboard/account",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8515:(e,t,s)=>{Promise.resolve().then(s.bind(s,9992))},2107:()=>{},3164:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},9992:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(326),a=s(7577),n=s(6795),o=s(5047);function l(){let[e,t]=(0,a.useState)(null),[s,l]=(0,a.useState)(!1),i=(0,o.useRouter)(),d=(0,n.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y"),[c,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),[h,b]=(0,a.useState)(""),x=async t=>{if(t.preventDefault(),p!==h)return alert("New passwords do not match");let s=[];if(p.length<8&&s.push("at least 8 characters"),/[a-z]/.test(p)||s.push("a lowercase letter"),/[A-Z]/.test(p)||s.push("an uppercase letter"),/[0-9]/.test(p)||s.push("a number"),/[!@#$%^&*(),.?":{}|<>\-_=+\\/\[\];']/.test(p)||s.push("a special character"),s.length)return alert("Password must contain: "+s.join(", "));l(!0);let{error:r}=await d.auth.signInWithPassword({email:e.email,password:c});if(r)return l(!1),alert("Incorrect current password.");let{error:a}=await d.auth.updateUser({password:p});a?alert("Failed to update password: "+a.message):(alert("Password updated successfully!"),u(""),m(""),b("")),l(!1)},g=async()=>{if(!confirm("Are you sure? This will disable your current Authenticator codes and require you to setup 2FA again."))return;l(!0);let t=await fetch("/api/auth/reset-2fa",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id})});if(t.ok)alert("2FA has been reset. Redirecting you to setup..."),i.push("/login/setup-2fa");else{let e=await t.json();alert("Failed to reset 2FA: "+(e?.error||"Unknown"))}l(!1)},[w,f]=(0,a.useState)(null),[j,v]=(0,a.useState)(0),y=async()=>{if(!confirm("Generate new backup codes? Previous codes will be invalidated."))return;l(!0);let t=await fetch("/api/auth/generate-backup-codes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,count:10})}),s=await t.json();t.ok?(f(s.codes||[]),v(10)):alert("Failed to generate backup codes: "+(s?.error||"Unknown")),l(!1)},N=async()=>{if(!w)return;let e=w.join("\n");try{await navigator.clipboard.writeText(e),alert("Backup codes copied to clipboard!")}catch(e){alert("Failed to copy codes")}};return e?(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-8",children:[r.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"My Account Settings"}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[r.jsx("span",{children:"\uD83D\uDD12"})," Change Password"]}),(0,r.jsxs)("form",{onSubmit:x,className:"max-w-md space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Current Password"}),r.jsx("input",{type:"password",required:!0,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:c,onChange:e=>u(e.target.value)})]}),r.jsx("div",{className:"pt-2 border-t border-slate-100"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"New Password"}),r.jsx("input",{type:"password",required:!0,minLength:6,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:p,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Confirm New Password"}),r.jsx("input",{type:"password",required:!0,minLength:6,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none",value:h,onChange:e=>b(e.target.value)})]}),r.jsx("button",{type:"submit",disabled:s,className:"bg-blue-900 text-white px-6 py-2 rounded hover:bg-blue-800 font-medium transition",children:s?"Updating...":"Update Password"})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-slate-800 mb-4 flex items-center gap-2",children:[r.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Two-Factor Authentication"]}),r.jsx("div",{className:"flex items-start gap-4",children:(0,r.jsxs)("div",{className:"bg-green-50 text-green-700 p-4 rounded-lg border border-green-100 flex-1",children:[r.jsx("p",{className:"font-bold",children:"Status: Active"}),r.jsx("p",{className:"text-sm mt-1",children:"Your account is secured with Google Authenticator."})]})}),(0,r.jsxs)("div",{className:"mt-6",children:[r.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Lost your phone or need to re-configure?"}),(0,r.jsxs)("div",{className:"flex gap-3 items-center flex-wrap",children:[r.jsx("button",{onClick:g,disabled:s,className:"border border-red-200 text-red-600 bg-red-50 px-4 py-2 rounded hover:bg-red-100 font-medium transition text-sm",children:"Re-install 2FA Keys"}),r.jsx("button",{onClick:y,disabled:s,className:"border border-slate-200 text-slate-700 bg-white px-4 py-2 rounded hover:bg-slate-50 font-medium transition text-sm",children:"Generate Backup Codes"})]}),!w&&j>0&&r.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700",children:(0,r.jsxs)("p",{children:[r.jsx("strong",{children:"Remaining backup codes:"})," ",j," unused"]})}),w&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-100 rounded",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("p",{className:"font-bold",children:"Backup codes (save these now — shown only once):"}),r.jsx("button",{onClick:N,className:"text-xs bg-white border border-yellow-200 px-2 py-1 rounded hover:bg-yellow-100 transition",children:"\uD83D\uDCCB Copy"})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:w.map((e,t)=>r.jsx("div",{className:"font-mono text-sm bg-white p-2 rounded border select-all",children:e},t))}),r.jsx("button",{onClick:()=>{if(!w)return;let e=new Blob(["Piyam Travels - Backup Codes\nSave these codes in a secure location.\nEach code can be used once for 2FA.\n\n"+w.join("\n")],{type:"text/plain"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="backup-codes.txt",s.click()},className:"text-xs bg-white border border-yellow-200 px-3 py-1.5 rounded hover:bg-yellow-100 transition",children:"⬇️ Download as Text File"})]})]})]})]}):r.jsx("div",{className:"p-8",children:"Loading..."})}},2644:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/workspaces/pt-portal/app/dashboard/account/page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,metadata:()=>a});var r=s(9510);s(7272);let a={title:"Piyam Travels IMS",description:"Employee Information Management System"};function n({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{children:e})})}},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,471,730],()=>s(1308));module.exports=r})();