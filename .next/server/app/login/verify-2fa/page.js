(()=>{var e={};e.id=507,e.ids=[507],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4981:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),r(1981),r(1506),r(5866);var a=r(3191),s=r(8716),n=r(7922),o=r.n(n),i=r(5231),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let d=["",{children:["login",{children:["verify-2fa",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1981)),"/workspaces/pt-portal/app/login/verify-2fa/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,1506)),"/workspaces/pt-portal/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspaces/pt-portal/app/login/verify-2fa/page.tsx"],u="/login/verify-2fa/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/login/verify-2fa/page",pathname:"/login/verify-2fa",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},2107:()=>{},3197:(e,t,r)=>{Promise.resolve().then(r.bind(r,1587))},3164:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},1587:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(326),s=r(7577),n=r(6795),o=r(5047),i=r(434);function l(){let[e,t]=(0,s.useState)(""),[r,l]=(0,s.useState)(""),[d,c]=(0,s.useState)(!1),u=(0,o.useRouter)(),p=(0,n.createBrowserClient)("https://ckubfbjfjbhuotyfwmac.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNrdWJmYmpmamJodW90eWZ3bWFjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5ODY1NzgsImV4cCI6MjA3NDU2MjU3OH0._Stz6_nHRQMqs2N1HdJ9Y7gEjL60s2ua9d5YcMn1H3Y"),m=async t=>{t.preventDefault(),l("");try{let t=await p.auth.getUser(),r=t?.data?.user;if(!r){l("No active session. Please sign in again.");return}if(d){if((await fetch("/api/auth/consume-backup-code",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:r.id,code:e})})).ok){window.history.replaceState(null,"","/dashboard"),u.push("/dashboard");return}l("Invalid or used backup code. Please try again.")}else{try{let{data:t,error:r}=await p.auth.mfa.listFactors();if(!r&&t?.all?.length){let r=t.all[0].id,{error:a}=await p.auth.mfa.challengeAndVerify({factorId:r,code:e});if(!a){window.history.replaceState(null,"","/dashboard"),u.push("/dashboard");return}}}catch(e){}l("Incorrect 2FA code. You can also try a backup code below.")}}catch(e){l("Verification failed. Please try again.")}};return(0,a.jsxs)("div",{className:"flex min-h-screen items-center justify-center bg-slate-50",children:[a.jsx("div",{className:"absolute top-4 left-4",children:a.jsx(i.default,{href:"/login",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm font-medium",children:"â† Back to Login"})}),(0,a.jsxs)("div",{className:"w-full max-w-md p-8 bg-white rounded-xl shadow-lg border border-slate-200 text-center",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-50 rounded-full flex items-center justify-center mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-blue-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),a.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Two-Factor Authentication"}),d?(0,a.jsxs)(a.Fragment,{children:[a.jsx("p",{className:"text-slate-500 mb-6 text-sm",children:"Enter one of your backup codes. Each code can only be used once."}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[a.jsx("input",{type:"text",placeholder:"Backup code",maxLength:16,autoFocus:!0,className:"w-full text-center text-xl p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none font-mono",value:e,onChange:e=>t(e.target.value)}),r&&a.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded",children:r}),a.jsx("button",{type:"submit",className:"w-full py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition",children:"Verify with Backup Code"})]}),a.jsx("button",{type:"button",className:"mt-4 text-sm text-blue-700 hover:underline",onClick:()=>{c(!1),l(""),t("")},children:"Use authenticator app"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-slate-500 mb-6 text-sm",children:["Open Google Authenticator and enter the code for ",a.jsx("strong",{children:"Piyam Travels"}),"."]}),(0,a.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[a.jsx("input",{type:"text",placeholder:"000 000",maxLength:6,autoFocus:!0,className:"w-full text-center text-3xl tracking-[0.5em] p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none font-mono",value:e,onChange:e=>t(e.target.value)}),r&&a.jsx("div",{className:"p-3 bg-red-50 text-red-600 text-sm rounded",children:r}),a.jsx("button",{type:"submit",className:"w-full py-3 bg-blue-900 text-white rounded-lg font-bold hover:bg-blue-800 transition",children:"Verify Identity"})]}),a.jsx("button",{type:"button",className:"mt-4 text-sm text-blue-700 hover:underline",onClick:()=>{c(!0),l(""),t("")},children:"Use backup code"})]}),a.jsx("button",{onClick:()=>u.push("/login"),className:"mt-6 text-sm text-slate-400 hover:text-slate-600",children:"Back to Login"})]})]})}},1506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>s});var a=r(9510);r(7272);let s={title:"Piyam Travels IMS",description:"Employee Information Management System"};function n({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{children:e})})}},1981:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(8570).createProxy)(String.raw`/workspaces/pt-portal/app/login/verify-2fa/page.tsx#default`)},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,471,730,434],()=>r(4981));module.exports=a})();